%% Mermaid State Diagram: Deterministic Workflow (IDLE → CHECKOUT → EXECUTION → AUDIT)
stateDiagram-v2
  [*] --> IDLE
  IDLE: Waiting for User Prompt
  IDLE --> INTENT_CHECKOUT: select_active_intent(intent_id)
  INTENT_CHECKOUT --> EXECUTION: PreHook.validate(intent_id) and SYSTEM_PROMPT += <intent_context>
  EXECUTION: LLM Reasoning + Tooling
  EXECUTION --> AUDIT: PostHook.append(agent_trace.jsonl)
  AUDIT --> [*]

  IDLE --> [*]: abort
  INTENT_CHECKOUT --> IDLE: invalid intent / scope violation
