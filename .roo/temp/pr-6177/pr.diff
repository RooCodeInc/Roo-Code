diff --git a/packages/types/src/history.ts b/packages/types/src/history.ts
index 8c75024879c..ace134566e3 100644
--- a/packages/types/src/history.ts
+++ b/packages/types/src/history.ts
@@ -16,6 +16,7 @@ export const historyItemSchema = z.object({
 	totalCost: z.number(),
 	size: z.number().optional(),
 	workspace: z.string().optional(),
+	mode: z.string().optional(),
 })
 
 export type HistoryItem = z.infer<typeof historyItemSchema>
diff --git a/src/core/task-persistence/taskMetadata.ts b/src/core/task-persistence/taskMetadata.ts
index 1759a72f475..7b93b5c14a0 100644
--- a/src/core/task-persistence/taskMetadata.ts
+++ b/src/core/task-persistence/taskMetadata.ts
@@ -18,6 +18,7 @@ export type TaskMetadataOptions = {
 	taskNumber: number
 	globalStoragePath: string
 	workspace: string
+	mode?: string
 }
 
 export async function taskMetadata({
@@ -26,6 +27,7 @@ export async function taskMetadata({
 	taskNumber,
 	globalStoragePath,
 	workspace,
+	mode,
 }: TaskMetadataOptions) {
 	const taskDir = await getTaskDirectoryPath(globalStoragePath, taskId)
 
@@ -92,6 +94,7 @@ export async function taskMetadata({
 		totalCost: tokenUsage.totalCost,
 		size: taskDirSize,
 		workspace,
+		mode,
 	}
 
 	return { historyItem, tokenUsage }
diff --git a/src/core/task/Task.ts b/src/core/task/Task.ts
index 95d12f66aa1..ce42970a3dd 100644
--- a/src/core/task/Task.ts
+++ b/src/core/task/Task.ts
@@ -405,12 +405,17 @@ export class Task extends EventEmitter<ClineEvents> {
 				globalStoragePath: this.globalStoragePath,
 			})
 
+			const provider = this.providerRef.deref()
+			const state = await provider?.getState()
+			const currentMode = state?.mode
+
 			const { historyItem, tokenUsage } = await taskMetadata({
 				messages: this.clineMessages,
 				taskId: this.taskId,
 				taskNumber: this.taskNumber,
 				globalStoragePath: this.globalStoragePath,
 				workspace: this.cwd,
+				mode: currentMode,
 			})
 
 			this.emit("taskTokenUsageUpdated", this.taskId, tokenUsage)
diff --git a/src/core/webview/ClineProvider.ts b/src/core/webview/ClineProvider.ts
index 905e657b37e..cb32b05a684 100644
--- a/src/core/webview/ClineProvider.ts
+++ b/src/core/webview/ClineProvider.ts
@@ -578,6 +578,11 @@ export class ClineProvider
 	public async initClineWithHistoryItem(historyItem: HistoryItem & { rootTask?: Task; parentTask?: Task }) {
 		await this.removeClineFromStack()
 
+		// If the history item has a saved mode, restore it
+		if (historyItem.mode) {
+			await this.updateGlobalState("mode", historyItem.mode)
+		}
+
 		const {
 			apiConfiguration,
 			diffEnabled: enableDiff,
@@ -807,6 +812,14 @@ export class ClineProvider
 		if (cline) {
 			TelemetryService.instance.captureModeSwitch(cline.taskId, newMode)
 			cline.emit("taskModeSwitched", cline.taskId, newMode)
+
+			// Update the task history with the new mode
+			const history = this.getGlobalState("taskHistory") ?? []
+			const taskHistoryItem = history.find((item) => item.id === cline.taskId)
+			if (taskHistoryItem) {
+				taskHistoryItem.mode = newMode
+				await this.updateTaskHistory(taskHistoryItem)
+			}
 		}
 
 		await this.updateGlobalState("mode", newMode)
