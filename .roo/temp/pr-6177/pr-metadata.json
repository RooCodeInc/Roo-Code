{
	"additions": 22,
	"author": { "is_bot": true, "login": "app/roomote" },
	"baseRefName": "main",
	"body": "## Summary\n\nThis PR implements sticky mode functionality for tasks, ensuring that when a task is reopened from history, it automatically switches to the last mode that was active on that task.\n\n## Changes\n\n- Added `mode` field to `HistoryItem` schema to persist the selected mode\n- Updated `taskMetadata` function to save the current mode when creating history items\n- Modified `handleModeSwitch` to update task history with the new mode when switching modes on an active task\n- Updated `initClineWithHistoryItem` to restore the saved mode when reopening tasks from history\n\n## Behavior\n\n1. When a task is running and the user switches modes, the new mode is saved to the task's history\n2. When a task is reopened from history, it automatically switches to the last saved mode\n3. If a task has no saved mode (e.g., older tasks), it will use the current default mode\n\n## Testing\n\n- All existing tests pass ✅\n- Type checking passes ✅\n- Linting passes ✅\n\nThis feature improves the user experience by maintaining context when switching between tasks, eliminating the need to manually switch back to the desired mode after reopening a task.\n<!-- ELLIPSIS_HIDDEN -->\n\n----\n\n> [!IMPORTANT]\n> Introduces sticky mode for tasks, saving and restoring the last used mode across sessions by updating task history and metadata handling.\n> \n>   - **Behavior**:\n>     - Tasks now save the current mode to history when switching modes (`handleModeSwitch` in `ClineProvider`).\n>     - When reopening tasks from history, the last saved mode is restored (`initClineWithHistoryItem` in `ClineProvider`).\n>     - If no mode is saved, the default mode is used.\n>   - **Schema**:\n>     - Added `mode` field to `HistoryItem` schema in `history.ts`.\n>   - **Functions**:\n>     - Updated `taskMetadata` in `taskMetadata.ts` to include mode when creating history items.\n>     - Modified `Task` class to save mode in task history when saving messages.\n>   - **Testing**:\n>     - All existing tests, type checking, and linting pass.\n> \n> <sup>This description was created by </sup>[<img alt=\"Ellipsis\" src=\"https://img.shields.io/badge/Ellipsis-blue?color=175173\">](https://www.ellipsis.dev?ref=RooCodeInc%2FRoo-Code&utm_source=github&utm_medium=referral)<sup> for a4b0ad356d9156b4cfa6bf64b8f1db6cacae48b3. You can [customize](https://app.ellipsis.dev/RooCodeInc/settings/summaries) this summary. It will automatically update as commits are pushed.</sup>\n\n<!-- ELLIPSIS_HIDDEN -->",
	"changedFiles": 4,
	"deletions": 0,
	"files": [
		{ "path": "packages/types/src/history.ts", "additions": 1, "deletions": 0 },
		{ "path": "src/core/task-persistence/taskMetadata.ts", "additions": 3, "deletions": 0 },
		{ "path": "src/core/task/Task.ts", "additions": 5, "deletions": 0 },
		{ "path": "src/core/webview/ClineProvider.ts", "additions": 13, "deletions": 0 }
	],
	"headRefName": "feature/sticky-mode-for-tasks",
	"number": 6177,
	"state": "OPEN",
	"title": "feat: make task mode sticky across sessions",
	"url": "https://github.com/RooCodeInc/Roo-Code/pull/6177"
}
