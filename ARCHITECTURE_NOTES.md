# ARCHITECTURE NOTES - Roo Code Codebase Analysis

## 1. Key Files Found

- src\extension.ts
- src/core/prompts/system.ts
- src/core/tools/write_to_file.ts

- src\activate\CodeActionProvider.ts
- src\activate\handleTask.ts
- src\activate\registerCodeActions.ts
- src\activate\registerCommands.ts
- src\activate\registerTerminalActions.ts
- src\activate\_\_tests\_\_\CodeActionProvider.spec.ts
- src\activate\_\_tests\_\_\registerCommands.spec.ts
- src\api\index.ts
- src\api\providers\anthropic-vertex.ts
- src\api\providers\anthropic.ts
- src\api\providers\base-openai-compatible-provider.ts
- src\api\providers\base-provider.ts
- src\api\providers\bedrock.ts
- src\api\providers\deepseek.ts
- src\api\providers\fake-ai.ts
- src\api\providers\gemini.ts
- src\api\providers\lite-llm.ts
- src\api\providers\lm-studio.ts
- src\api\providers\minimax.ts
- src\api\providers\mistral.ts
- src\api\providers\moonshot.ts
- src\api\providers\native-ollama.ts
- src\api\providers\openai-codex.ts
- src\api\providers\openai-compatible.ts
- src\api\providers\openai-native.ts
- src\api\providers\openai.ts
- src\api\providers\openrouter.ts
- src\api\providers\qwen-code.ts
- src\api\providers\requesty.ts
- src\api\providers\roo.ts
- src\api\providers\vercel-ai-gateway.ts
- src\api\providers\vscode-lm.ts
- src\api\providers\xai.ts
- src\api\providers\zai.ts
- src\api\providers\fetchers\litellm.ts
- src\api\providers\fetchers\lmstudio.ts
- src\api\providers\fetchers\modelCache.ts
- src\api\providers\fetchers\modelEndpointCache.ts
- src\api\providers\fetchers\ollama.ts
- src\api\providers\fetchers\openrouter.ts
- src\api\providers\fetchers\requesty.ts
- src\api\providers\fetchers\roo.ts
- src\api\providers\fetchers\vercel-ai-gateway.ts
- src\api\providers\fetchers\versionedSettings.ts
- src\api\providers\fetchers\_\_tests\_\_\litellm.spec.ts
- src\api\providers\fetchers\_\_tests\_\_\lmstudio.test.ts
- src\api\providers\fetchers\_\_tests\_\_\modelCache.spec.ts
- src\api\providers\fetchers\_\_tests\_\_\modelEndpointCache.spec.ts
- src\api\providers\fetchers\_\_tests\_\_\ollama.test.ts
- src\api\providers\fetchers\_\_tests\_\_\openrouter.spec.ts
- src\api\providers\fetchers\_\_tests\_\_\roo.spec.ts
- src\api\providers\fetchers\_\_tests\_\_\vercel-ai-gateway.spec.ts
- src\api\providers\fetchers\_\_tests\_\_\versionedSettings.spec.ts
- src\api\providers\utils\image-generation.ts
- src\api\providers\utils\router-tool-preferences.ts
- src\api\providers\utils\_\_tests\_\_\image-generation.spec.ts
- src\api\providers\_\_tests\_\_\anthropic-vertex.spec.ts
- src\api\providers\_\_tests\_\_\anthropic.spec.ts
- src\api\providers\_\_tests\_\_\base-openai-compatible-provider-timeout.spec.ts
- src\api\providers\_\_tests\_\_\base-openai-compatible-provider.spec.ts
- src\api\providers\_\_tests\_\_\base-provider.spec.ts
- src\api\providers\_\_tests\_\_\bedrock-custom-arn.spec.ts
- src\api\providers\_\_tests\_\_\bedrock-error-handling.spec.ts
- src\api\providers\_\_tests\_\_\bedrock-invokedModelId.spec.ts
- src\api\providers\_\_tests\_\_\bedrock-native-tools.spec.ts
- src\api\providers\_\_tests\_\_\bedrock-reasoning.spec.ts
- src\api\providers\_\_tests\_\_\bedrock-vpc-endpoint.spec.ts
- src\api\providers\_\_tests\_\_\bedrock.spec.ts
- src\api\providers\_\_tests\_\_\constants.spec.ts
- src\api\providers\_\_tests\_\_\deepseek.spec.ts
- src\api\providers\_\_tests\_\_\fireworks.spec.ts
- src\api\providers\_\_tests\_\_\gemini-handler.spec.ts
- src\api\providers\_\_tests\_\_\gemini.spec.ts
- src\api\providers\_\_tests\_\_\lite-llm.spec.ts
- src\api\providers\_\_tests\_\_\lmstudio-native-tools.spec.ts
- src\api\providers\_\_tests\_\_\lmstudio.spec.ts
- src\api\providers\_\_tests\_\_\minimax.spec.ts
- src\api\providers\_\_tests\_\_\mistral.spec.ts
- src\api\providers\_\_tests\_\_\moonshot.spec.ts
- src\api\providers\_\_tests\_\_\native-ollama.spec.ts
- src\api\providers\_\_tests\_\_\openai-codex-native-tool-calls.spec.ts
- src\api\providers\_\_tests\_\_\openai-native-tools.spec.ts
- src\api\providers\_\_tests\_\_\openai-native-usage.spec.ts
- src\api\providers\_\_tests\_\_\openai-native.spec.ts
- src\api\providers\_\_tests\_\_\openai-usage-tracking.spec.ts
- src\api\providers\_\_tests\_\_\openai.spec.ts
- src\api\providers\_\_tests\_\_\openrouter.spec.ts
- src\api\providers\_\_tests\_\_\qwen-code-native-tools.spec.ts
- src\api\providers\_\_tests\_\_\requesty.spec.ts
- src\api\providers\_\_tests\_\_\roo.spec.ts
- src\api\providers\_\_tests\_\_\sambanova.spec.ts
- src\api\providers\_\_tests\_\_\vercel-ai-gateway.spec.ts
- src\api\providers\_\_tests\_\_\vertex.spec.ts
- src\api\providers\_\_tests\_\_\vscode-lm.spec.ts
- src\api\providers\_\_tests\_\_\xai.spec.ts
- src\api\providers\_\_tests\_\_\zai.spec.ts
- src\api\transform\ai-sdk.ts
- src\api\transform\anthropic-filter.ts
- src\api\transform\bedrock-converse-format.ts
- src\api\transform\gemini-format.ts
- src\api\transform\minimax-format.ts
- src\api\transform\mistral-format.ts
- src\api\transform\model-params.ts
- src\api\transform\openai-format.ts
- src\api\transform\r1-format.ts
- src\api\transform\stream.ts
- src\api\transform\vscode-lm-format.ts
- src\api\transform\zai-format.ts
- src\api\transform\cache-strategy\base-strategy.ts
- src\api\transform\cache-strategy\multi-point-strategy.ts
- src\api\transform\cache-strategy\types.ts
- src\api\transform\cache-strategy\_\_tests\_\_\cache-strategy.spec.ts
- src\api\transform\caching\anthropic.ts
- src\api\transform\caching\gemini.ts
- src\api\transform\caching\vercel-ai-gateway.ts
- src\api\transform\caching\_\_tests\_\_\anthropic.spec.ts
- src\api\transform\caching\_\_tests\_\_\gemini.spec.ts
- src\api\transform\caching\_\_tests\_\_\vercel-ai-gateway.spec.ts
- src\api\transform\_\_tests\_\_\ai-sdk.spec.ts
- src\api\transform\_\_tests\_\_\anthropic-filter.spec.ts
- src\api\transform\_\_tests\_\_\bedrock-converse-format.spec.ts
- src\api\transform\_\_tests\_\_\gemini-format.spec.ts
- src\api\transform\_\_tests\_\_\minimax-format.spec.ts
- src\api\transform\_\_tests\_\_\mistral-format.spec.ts
- src\api\transform\_\_tests\_\_\model-params.spec.ts
- src\api\transform\_\_tests\_\_\openai-format.spec.ts
- src\api\transform\_\_tests\_\_\r1-format.spec.ts
- src\api\transform\_\_tests\_\_\reasoning.spec.ts
- src\api\transform\_\_tests\_\_\stream.spec.ts
- src\api\transform\_\_tests\_\_\vscode-lm-format.spec.ts
- src\core\assistant-message\NativeToolCallParser.ts
- src\core\assistant-message\presentAssistantMessage.ts
- src\core\assistant-message\types.ts
- src\core\assistant-message\_\_tests\_\_\NativeToolCallParser.spec.ts
- src\core\assistant-message\_\_tests\_\_\presentAssistantMessage-custom-tool.spec.ts
- src\core\assistant-message\_\_tests\_\_\presentAssistantMessage-images.spec.ts
- src\core\assistant-message\_\_tests\_\_\presentAssistantMessage-unknown-tool.spec.ts
- src\core\auto-approval\commands.ts
- src\core\auto-approval\index.ts
- src\core\auto-approval\mcp.ts
- src\core\auto-approval\tools.ts
- src\core\checkpoints\index.ts
- src\core\checkpoints\_\_tests\_\_\checkpoint.test.ts
- src\core\condense\foldedFileContext.ts
- src\core\condense\index.ts
- src\core\condense\_\_tests\_\_\condense.spec.ts
- src\core\condense\_\_tests\_\_\foldedFileContext.spec.ts
- src\core\condense\_\_tests\_\_\index.spec.ts
- src\core\condense\_\_tests\_\_\rewind-after-condense.spec.ts
- src\core\config\ContextProxy.ts
- src\core\config\CustomModesManager.ts
- src\core\config\importExport.ts
- src\core\config\ProviderSettingsManager.ts
- src\core\config\_\_tests\_\_\ContextProxy.spec.ts
- src\core\config\_\_tests\_\_\CustomModesManager.exportImportSlugChange.spec.ts
- src\core\config\_\_tests\_\_\CustomModesManager.spec.ts
- src\core\config\_\_tests\_\_\CustomModesSettings.spec.ts
- src\core\config\_\_tests\_\_\importExport.spec.ts
- src\core\config\_\_tests\_\_\ModeConfig.spec.ts
- src\core\config\_\_tests\_\_\ProviderSettingsManager.spec.ts
- src\core\context\context-management\context-error-handling.ts
- src\core\context\context-management\_\_tests\_\_\context-error-handling.test.ts
- src\core\context-management\index.ts
- src\core\context-management\_\_tests\_\_\context-management.spec.ts
- src\core\context-tracking\FileContextTracker.ts
- src\core\context-tracking\FileContextTrackerTypes.ts
- src\core\diff\strategies\multi-search-replace.ts
- src\core\environment\getEnvironmentDetails.ts
- src\core\environment\reminder.ts
- src\core\environment\_\_tests\_\_\getEnvironmentDetails.spec.ts
- src\core\ignore\RooIgnoreController.ts
- src\core\ignore\_\_mocks\_\_\RooIgnoreController.ts
- src\core\ignore\_\_tests\_\_\RooIgnoreController.security.spec.ts
- src\core\ignore\_\_tests\_\_\RooIgnoreController.spec.ts
- src\core\mentions\index.ts
- src\core\mentions\processUserContentMentions.ts
- src\core\mentions\resolveImageMentions.ts
- src\core\mentions\_\_tests\_\_\processUserContentMentions.spec.ts
- src\core\mentions\_\_tests\_\_\resolveImageMentions.spec.ts
- src\core\message-manager\index.spec.ts
- src\core\message-manager\index.ts
- src\core\prompts\responses.ts
- src\core\prompts\system.ts
- src\core\prompts\types.ts
- src\core\prompts\sections\capabilities.ts
- src\core\prompts\sections\custom-instructions.ts
- src\core\prompts\sections\index.ts
- src\core\prompts\sections\modes.ts
- src\core\prompts\sections\objective.ts
- src\core\prompts\sections\rules.ts
- src\core\prompts\sections\skills.ts
- src\core\prompts\sections\system-info.ts
- src\core\prompts\sections\tool-use-guidelines.ts
- src\core\prompts\sections\tool-use.ts
- src\core\prompts\sections\_\_tests\_\_\custom-instructions.spec.ts
- src\core\prompts\sections\_\_tests\_\_\objective.spec.ts
- src\core\prompts\sections\_\_tests\_\_\tool-use-guidelines.spec.ts
- src\core\prompts\sections\_\_tests\_\_\tool-use.spec.ts
- src\core\prompts\tools\filter-tools-for-mode.ts
- src\core\prompts\tools\native-tools\access_mcp_resource.ts
- src\core\prompts\tools\native-tools\apply_diff.ts
- src\core\prompts\tools\native-tools\apply_patch.ts
- src\core\prompts\tools\native-tools\ask_followup_question.ts
- src\core\prompts\tools\native-tools\attempt_completion.ts
- src\core\prompts\tools\native-tools\codebase_search.ts
- src\core\prompts\tools\native-tools\converters.ts
- src\core\prompts\tools\native-tools\edit.ts
- src\core\prompts\tools\native-tools\edit_file.ts
- src\core\prompts\tools\native-tools\execute_command.ts
- src\core\prompts\tools\native-tools\generate_image.ts
- src\core\prompts\tools\native-tools\index.ts
- src\core\prompts\tools\native-tools\list_files.ts
- src\core\prompts\tools\native-tools\mcp_server.ts
- src\core\prompts\tools\native-tools\new_task.ts
- src\core\prompts\tools\native-tools\read_command_output.ts
- src\core\prompts\tools\native-tools\read_file.ts
- src\core\prompts\tools\native-tools\run_slash_command.ts
- src\core\prompts\tools\native-tools\search_files.ts
- src\core\prompts\tools\native-tools\search_replace.ts
- src\core\prompts\tools\native-tools\skill.ts
- src\core\prompts\tools\native-tools\switch_mode.ts
- src\core\prompts\tools\native-tools\update_todo_list.ts
- src\core\prompts\tools\native-tools\write_to_file.ts
- src\core\prompts\tools\native-tools\_\_tests\_\_\converters.spec.ts
- src\core\prompts\tools\native-tools\_\_tests\_\_\mcp_server.spec.ts
- src\core\prompts\tools\native-tools\_\_tests\_\_\read_file.spec.ts
- src\core\prompts\tools\_\_tests\_\_\filter-tools-for-mode.spec.ts
- src\core\prompts\_\_tests\_\_\add-custom-instructions.spec.ts
- src\core\prompts\_\_tests\_\_\get-prompt-component.spec.ts
- src\core\prompts\_\_tests\_\_\responses-rooignore.spec.ts
- src\core\prompts\_\_tests\_\_\sections.spec.ts
- src\core\prompts\_\_tests\_\_\system-prompt.spec.ts
- src\core\protect\RooProtectedController.ts
- src\core\protect\_\_tests\_\_\RooProtectedController.spec.ts
- src\core\task\build-tools.ts
- src\core\task\Task.ts
- src\core\task\validateToolResultIds.ts
- src\core\task\_\_tests\_\_\duplicate-tool-use-ids.spec.ts
- src\core\task\_\_tests\_\_\flushPendingToolResultsToHistory.spec.ts
- src\core\task\_\_tests\_\_\grace-retry-errors.spec.ts
- src\core\task\_\_tests\_\_\grounding-sources.test.ts
- src\core\task\_\_tests\_\_\native-tools-filtering.spec.ts
- src\core\task\_\_tests\_\_\new-task-isolation.spec.ts
- src\core\task\_\_tests\_\_\reasoning-preservation.test.ts
- src\core\task\_\_tests\_\_\task-tool-history.spec.ts
- src\core\task\_\_tests\_\_\Task.dispose.test.ts
- src\core\task\_\_tests\_\_\Task.persistence.spec.ts
- src\core\task\_\_tests\_\_\Task.spec.ts
- src\core\task\_\_tests\_\_\Task.sticky-profile-race.spec.ts
- src\core\task\_\_tests\_\_\Task.throttle.test.ts
- src\core\task\_\_tests\_\_\validateToolResultIds.spec.ts
- src\core\task-persistence\apiMessages.ts
- src\core\task-persistence\taskMessages.ts
- src\core\task-persistence\taskMetadata.ts
- src\core\task-persistence\_\_tests\_\_\apiMessages.spec.ts
- src\core\task-persistence\_\_tests\_\_\taskMessages.spec.ts
- src\core\tools\accessMcpResourceTool.ts
- src\core\tools\ApplyDiffTool.ts
- src\core\tools\ApplyPatchTool.ts
- src\core\tools\AskFollowupQuestionTool.ts
- src\core\tools\AttemptCompletionTool.ts
- src\core\tools\BaseTool.ts
- src\core\tools\CodebaseSearchTool.ts
- src\core\tools\EditFileTool.ts
- src\core\tools\EditTool.ts
- src\core\tools\ExecuteCommandTool.ts
- src\core\tools\GenerateImageTool.ts
- src\core\tools\ListFilesTool.ts
- src\core\tools\NewTaskTool.ts
- src\core\tools\ReadCommandOutputTool.ts
- src\core\tools\ReadFileTool.ts
- src\core\tools\RunSlashCommandTool.ts
- src\core\tools\SearchAndReplaceTool.ts
- src\core\tools\SearchFilesTool.ts
- src\core\tools\SearchReplaceTool.ts
- src\core\tools\SkillTool.ts
- src\core\tools\SwitchModeTool.ts
- src\core\tools\ToolRepetitionDetector.ts
- src\core\tools\UpdateTodoListTool.ts
- src\core\tools\UseMcpToolTool.ts
- src\core\tools\validateToolUse.ts
- src\core\tools\WriteToFileTool.ts
- src\core\tools\apply-patch\apply.ts
- src\core\tools\apply-patch\index.ts
- src\core\tools\apply-patch\parser.ts
- src\core\tools\apply-patch\seek-sequence.ts
- src\core\tools\helpers\imageHelpers.ts
- src\core\tools\helpers\toolResultFormatting.ts
- src\core\tools\helpers\_\_tests\_\_\toolResultFormatting.spec.ts
- src\core\tools\_\_tests\_\_\applyPatchTool.partial.spec.ts
- src\core\tools\_\_tests\_\_\askFollowupQuestionTool.spec.ts
- src\core\tools\_\_tests\_\_\attemptCompletionTool.spec.ts
- src\core\tools\_\_tests\_\_\editFileTool.spec.ts
- src\core\tools\_\_tests\_\_\editTool.spec.ts
- src\core\tools\_\_tests\_\_\executeCommand.spec.ts
- src\core\tools\_\_tests\_\_\executeCommandTimeout.integration.spec.ts
- src\core\tools\_\_tests\_\_\executeCommandTool.spec.ts
- src\core\tools\_\_tests\_\_\generateImageTool.test.ts
- src\core\tools\_\_tests\_\_\newTaskTool.spec.ts
- src\core\tools\_\_tests\_\_\ReadCommandOutputTool.test.ts
- src\core\tools\_\_tests\_\_\readFileTool.spec.ts
- src\core\tools\_\_tests\_\_\runSlashCommandTool.spec.ts
- src\core\tools\_\_tests\_\_\searchAndReplaceTool.spec.ts
- src\core\tools\_\_tests\_\_\searchReplaceTool.spec.ts
- src\core\tools\_\_tests\_\_\skillTool.spec.ts
- src\core\tools\_\_tests\_\_\ToolRepetitionDetector.spec.ts
- src\core\tools\_\_tests\_\_\updateTodoListTool.spec.ts
- src\core\tools\_\_tests\_\_\useMcpToolTool.spec.ts
- src\core\tools\_\_tests\_\_\validateToolUse.spec.ts
- src\core\tools\_\_tests\_\_\writeToFileTool.spec.ts
- src\core\webview\ClineProvider.ts
- src\core\webview\diagnosticsHandler.ts
- src\core\webview\generateSystemPrompt.ts
- src\core\webview\messageEnhancer.ts
- src\core\webview\webviewMessageHandler.ts
- src\core\webview\_\_tests\_\_\ClineProvider.apiHandlerRebuild.spec.ts
- src\core\webview\_\_tests\_\_\ClineProvider.lockApiConfig.spec.ts
- src\core\webview\_\_tests\_\_\ClineProvider.spec.ts
- src\core\webview\_\_tests\_\_\ClineProvider.sticky-mode.spec.ts
- src\core\webview\_\_tests\_\_\ClineProvider.sticky-profile.spec.ts
- src\core\webview\_\_tests\_\_\ClineProvider.taskHistory.spec.ts
- src\core\webview\_\_tests\_\_\diagnosticsHandler.spec.ts
- src\core\webview\_\_tests\_\_\messageEnhancer.test.ts
- src\core\webview\_\_tests\_\_\webviewMessageHandler.checkpoint.spec.ts
- src\core\webview\_\_tests\_\_\webviewMessageHandler.delete.spec.ts
- src\core\webview\_\_tests\_\_\webviewMessageHandler.edit.spec.ts
- src\core\webview\_\_tests\_\_\webviewMessageHandler.imageMentions.integration.spec.ts
- src\core\webview\_\_tests\_\_\webviewMessageHandler.routerModels.spec.ts
- src\core\webview\_\_tests\_\_\webviewMessageHandler.searchFiles.spec.ts
- src\core\webview\_\_tests\_\_\webviewMessageHandler.spec.ts
- src\extension\api.ts
- src\integrations\editor\DecorationController.ts
- src\integrations\editor\DiffViewProvider.ts
- src\integrations\editor\_\_tests\_\_\DiffViewProvider.spec.ts
- src\integrations\misc\export-markdown.ts
- src\integrations\misc\extract-text.ts
- src\integrations\misc\image-handler.ts
- src\integrations\misc\indentation-reader.ts
- src\integrations\misc\open-file.ts
- src\integrations\misc\_\_tests\_\_\export-markdown.spec.ts
- src\integrations\misc\_\_tests\_\_\extract-text.spec.ts
- src\integrations\misc\_\_tests\_\_\open-file.spec.ts
- src\integrations\misc\_\_tests\_\_\read-lines.spec.ts
- src\integrations\misc\_\_tests\_\_\performance\processCarriageReturns.benchmark.ts
- src\integrations\openai-codex\oauth.ts
- src\integrations\terminal\OutputInterceptor.ts
- src\integrations\terminal\ShellIntegrationManager.ts
- src\integrations\terminal\Terminal.ts
- src\integrations\terminal\TerminalProcess.ts
- src\integrations\terminal\_\_tests\_\_\OutputInterceptor.test.ts
- src\integrations\terminal\_\_tests\_\_\setupTerminalTests.ts
- src\integrations\terminal\_\_tests\_\_\TerminalProcessExec.pwsh.spec.ts
- src\integrations\terminal\_\_tests\_\_\TerminalRegistry.spec.ts
- src\integrations\theme\getTheme.ts
- src\services\checkpoints\ShadowCheckpointService.ts
- src\services\checkpoints\_\_tests\_\_\ShadowCheckpointService.spec.ts
- src\services\code-index\cache-manager.ts
- src\services\code-index\manager.ts
- src\services\code-index\service-factory.ts
- src\services\code-index\embedders\bedrock.ts
- src\services\code-index\embedders\ollama.ts
- src\services\code-index\embedders\openai-compatible.ts
- src\services\code-index\embedders\openai.ts
- src\services\code-index\embedders\openrouter.ts
- src\services\code-index\embedders\_\_tests\_\_\bedrock.spec.ts
- src\services\code-index\embedders\_\_tests\_\_\openai-compatible-rate-limit.spec.ts
- src\services\code-index\embedders\_\_tests\_\_\openai-compatible.spec.ts
- src\services\code-index\embedders\_\_tests\_\_\openai.spec.ts
- src\services\code-index\embedders\_\_tests\_\_\openrouter.spec.ts
- src\services\code-index\interfaces\embedder.ts
- src\services\code-index\processors\file-watcher.ts
- src\services\code-index\processors\scanner.ts
- src\services\code-index\processors\_\_tests\_\_\file-watcher.spec.ts
- src\services\code-index\processors\_\_tests\_\_\parser.spec.ts
- src\services\code-index\processors\_\_tests\_\_\parser.vb.spec.ts
- src\services\code-index\processors\_\_tests\_\_\scanner.spec.ts
- src\services\code-index\_\_tests\_\_\cache-manager.spec.ts
- src\services\code-index\_\_tests\_\_\manager.spec.ts
- src\services\command\built-in-commands.ts
- src\services\glob\_\_tests\_\_\gitignore-integration.spec.ts
- src\services\glob\_\_tests\_\_\gitignore-test.spec.ts
- src\services\marketplace\SimpleInstaller.ts
- src\services\marketplace\_\_tests\_\_\MarketplaceManager.spec.ts
- src\services\marketplace\_\_tests\_\_\SimpleInstaller.spec.ts
- src\services\mcp\McpHub.ts
- src\services\mcp\_\_tests\_\_\McpHub.spec.ts
- src\services\ripgrep\index.ts
- src\services\roo-config\index.ts
- src\services\skills\SkillsManager.ts
- src\services\skills\_\_tests\_\_\SkillsManager.spec.ts
- src\services\tree-sitter\index.ts
- src\services\tree-sitter\queries\ruby.ts
- src\services\tree-sitter\_\_tests\_\_\parseSourceCodeDefinitions.ruby.spec.ts
- src\services\tree-sitter\_\_tests\_\_\fixtures\sample-c-sharp.ts
- src\services\tree-sitter\_\_tests\_\_\fixtures\sample-elisp.ts
- src\services\tree-sitter\_\_tests\_\_\fixtures\sample-php.ts
- src\services\tree-sitter\_\_tests\_\_\fixtures\sample-ruby.ts
- src\services\tree-sitter\_\_tests\_\_\fixtures\sample-rust.ts
- src\shared\cost.ts
- src\shared\experiments.ts
- src\shared\getApiMetrics.ts
- src\shared\modes.ts
- src\shared\support-prompt.ts
- src\shared\todo.ts
- src\shared\tools.ts
- src\shared\_\_tests\_\_\api.spec.ts
- src\shared\_\_tests\_\_\combineApiRequests.spec.ts
- src\shared\_\_tests\_\_\combineCommandSequences.spec.ts
- src\shared\_\_tests\_\_\experiments.spec.ts
- src\shared\_\_tests\_\_\getApiMetrics.spec.ts
- src\shared\_\_tests\_\_\modes-empty-prompt-component.spec.ts
- src\shared\_\_tests\_\_\modes.spec.ts
- src\shared\_\_tests\_\_\support-prompts.spec.ts
- src\utils\json-schema.ts
- src\utils\mcp-name.ts
- src\utils\migrateSettings.ts
- src\utils\outputChannelLogger.ts
- src\utils\safeWriteJson.ts
- src\utils\shell.ts
- src\utils\single-completion-handler.ts
- src\utils\storage.ts
- src\utils\tiktoken.ts
- src\utils\tool-id.ts
- src\utils\logging\CompactLogger.ts
- src\utils\logging\CompactTransport.ts
- src\utils\logging\types.ts
- src\utils\logging\_\_tests\_\_\CompactTransport.spec.ts
- src\utils\logging\_\_tests\_\_\MockTransport.ts
- src\utils\_\_tests\_\_\cost.spec.ts
- src\utils\_\_tests\_\_\enhance-prompt.spec.ts
- src\utils\_\_tests\_\_\json-schema.spec.ts
- src\utils\_\_tests\_\_\mcp-name.spec.ts
- src\utils\_\_tests\_\_\safeWriteJson.test.ts
- src\utils\_\_tests\_\_\shell.spec.ts
- src\utils\_\_tests\_\_\tiktoken.spec.ts
- src\utils\_\_tests\_\_\tool-id.spec.ts
- src\_\_mocks\_\_\fs\promises.ts
- src\_\_tests\_\_\command-mentions.spec.ts
- src\_\_tests\_\_\history-resume-delegation.spec.ts
- src\_\_tests\_\_\migrateSettings.spec.ts
- src\_\_tests\_\_\nested-delegation-resume.spec.ts

## 2. extension.ts - Main Entry Point

**Function signature:** export async function activate(context: vscode.ExtensionContext)

**What it does:** What it does: Called when VS Code starts the extension. Creates the main controller.

## 3. controller/index.ts - Message Handler

**Function signature:** [Find handleWebviewMessage and paste its signature]

**What it does:** [Write 1-2 sentences]

## 4. prompts/system.ts - System Prompt Builder

**Function signature:** [Find buildSystemPrompt and paste its signature]

**What it does:** [Write 1-2 sentences]

## 5. tools/write_to_file.ts - File Writing Tool

**Function signature:** [Find the handler function signature]

**What it does:** [Write 1-2 sentences]

## 6. Tool Execution Call Stack

[Trace how a tool call flows from webview to execution]

Step 1:
Step 2:
Step 3:
Step 4:

## 7. Message Flow Diagram

[Draw simple arrows or describe]

Webview UI → [something] → [something] → Tool Execution
