import { ToolExecutionContext } from "../types";
import { readActiveIntents } from "../utils/fileUtils";

export const contextLoader: PreHook = async (ctx) => {
    if (!ctx.intentId) return ctx;

    const activeIntents = await readActiveIntents();
    const intent = activeIntents.find((i: any) => i.id === ctx.intentId);
    if (!intent) throw new Error(`Intent ${ctx.intentId} not found in active_intents.yaml`);

    // Inject intent context into args for the agent
    ctx.args.intentContext = {
        constraints: intent.constraints,
        scope: intent.owned_scope,
        acceptanceCriteria: intent.acceptance_criteria,
    };

    return ctx;
};
